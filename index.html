<!doctype html>
<html lang="vi">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Tr√≤ ch∆°i tr·∫Øc nghi·ªám ‚Äî Thi·∫øt b·ªã m·∫°ng</title>
    <style>
        :root {
            --bg: #0f1724;
            --card: #0b1220;
            --accent: #06b6d4;
            --muted: #94a3b8;
            --success: #10b981;
            --danger: #ef4444
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%
        }

        body {
            margin: 0;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            color: #e6eef6;
            background: linear-gradient(180deg, #031025 0%, var(--bg) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 28px
        }

        .wrap {
            width: 960px;
            max-width: 96%;
        }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 18px
        }

        h1 {
            font-size: 20px;
            margin: 0;
            color: white
        }

        .meta {
            color: var(--muted);
            font-size: 13px
        }

        .card {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 30px rgba(2, 6, 23, 0.6);
        }

        .question {
            display: flex;
            gap: 16px;
            align-items: flex-start
        }

        .q-index {
            min-width: 44px;
            height: 44px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.03);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700
        }

        .q-body {
            flex: 1
        }

        .q-text {
            font-size: 16px;
            margin: 0 0 8px
        }

        .options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px
        }

        .opt {
            background: rgba(255, 255, 255, 0.02);
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            border: 1px solid transparent
        }

        .opt:hover {
            transform: translateY(-2px)
        }

        .opt.selected {
            outline: 2px solid rgba(6, 182, 212, 0.12);
            background: linear-gradient(90deg, rgba(6, 182, 212, 0.06), rgba(6, 182, 212, 0.02))
        }

        .opt.correct {
            border-color: var(--success);
            box-shadow: 0 4px 18px rgba(16, 185, 129, 0.06)
        }

        .opt.wrong {
            border-color: var(--danger);
            opacity: 0.9
        }

        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 14px
        }

        button {
            background: var(--accent);
            color: #042027;
            border: none;
            padding: 10px 14px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer
        }

        button.ghost {
            background: transparent;
            color: var(--accent);
            border: 1px solid rgba(6, 182, 212, 0.12)
        }

        .explain {
            margin-top: 12px;
            padding: 12px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.02);
            color: var(--muted);
            display: none
        }

        .scorebar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 14px
        }

        .progress {
            height: 10px;
            background: rgba(255, 255, 255, 0.04);
            border-radius: 999px;
            flex: 1;
            margin: 0 12px;
            overflow: hidden
        }

        .progress>i {
            display: block;
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #7c3aed);
            width: 0%
        }

        .result {
            display: none;
            margin-top: 12px;
            padding: 14px;
            border-radius: 10px;
            background: linear-gradient(90deg, rgba(7, 89, 133, 0.12), rgba(6, 182, 212, 0.06));
            color: white
        }

        .footer-note {
            font-size: 13px;
            color: var(--muted);
            margin-top: 10px
        }

        @media (max-width:640px) {
            .options {
                grid-template-columns: 1fr
            }
        }
    </style>
</head>

<body>
    <div class="wrap">
        <header>
            <div>
                <h1>Tr·∫Øc nghi·ªám: </h1>
                <div class="meta">Ch·ªçn ƒë√°p √°n ƒë√∫ng ‚Äî xem gi·∫£i th√≠ch ngay sau khi tr·∫£ l·ªùi</div>
            </div>
            <div>
                <input type="file" id="fileInput" accept=".json" style="display:none">
                <button id="btnUpload">üìÇ T·∫£i c√¢u h·ªèi</button>
                <button id="btnClear" class="ghost">üóë X√≥a b·ªô c√¢u h·ªèi</button>
            </div>
        </header>

        <div class="card" id="card"></div>

        <div class="footer-note">
            M·∫πo: b·∫•m s·ªë 1‚Äì4 tr√™n b√†n ph√≠m ƒë·ªÉ ch·ªçn ƒë√°p √°n.
            C√¢u h·ªèi l∆∞u trong localStorage, c√≥ th·ªÉ upload file JSON ƒë·ªÉ thay ƒë·ªïi.
        </div>
    </div>

    <script>
        const LS_KEY = 'quiz_questions_v1';
        let QUESTIONS = JSON.parse(localStorage.getItem(LS_KEY) || 'null');

        // N√∫t upload JSON
        const uploadBtn = document.createElement('input');
        uploadBtn.type = 'file';
        uploadBtn.accept = '.json';
        uploadBtn.style.display = 'none';
        document.body.appendChild(uploadBtn);

        // N√∫t visible
        const triggerBtn = document.createElement('button');
        triggerBtn.textContent = 'üìÇ T·∫£i file JSON c√¢u h·ªèi';
        triggerBtn.style.marginBottom = '14px';
        document.querySelector('.wrap').prepend(triggerBtn);

        // X·ª≠ l√Ω khi ch·ªçn file
        triggerBtn.addEventListener('click', () => uploadBtn.click());
        uploadBtn.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                try {
                    const data = JSON.parse(ev.target.result);
                    if (Array.isArray(data)) {
                        QUESTIONS = data;
                        localStorage.setItem(LS_KEY, JSON.stringify(QUESTIONS));
                        alert('‚úÖ ƒê√£ t·∫£i d·ªØ li·ªáu m·ªõi! Trang s·∫Ω t·∫£i l·∫°i.');
                        location.reload();
                    } else {
                        alert('‚ùå File JSON kh√¥ng h·ª£p l·ªá.');
                    }
                } catch (err) {
                    alert('‚ö†Ô∏è L·ªói ƒë·ªçc file JSON: ' + err.message);
                }
            };
            reader.readAsText(file);
        });

        // N·∫øu ch∆∞a c√≥ localStorage ‚Üí ƒë·ªçc file data.json (t·ª± ƒë·ªông)
        if (!QUESTIONS) {
            fetch('data.json')
                .then(r => r.json())
                .then(data => {
                    QUESTIONS = data;
                    localStorage.setItem(LS_KEY, JSON.stringify(QUESTIONS));
                    location.reload();
                })
                .catch(err => {
                    console.error('Kh√¥ng th·ªÉ t·∫£i data.json', err);
                    alert('Kh√¥ng t√¨m th·∫•y data.json, vui l√≤ng t·∫£i file JSON th·ªß c√¥ng.');
                });
        }
        // === X√≥a d·ªØ li·ªáu ===
        document.getElementById('btnClear').addEventListener('click', () => {
            if (confirm('X√≥a to√†n b·ªô c√¢u h·ªèi hi·ªán t·∫°i?')) {
                localStorage.removeItem(LS_KEY);
                alert('ƒê√£ x√≥a. Trang s·∫Ω t·∫£i l·∫°i.');
                location.reload();
            }
        });

        // === Logic game (gi·ªØ nguy√™n nh∆∞ tr∆∞·ªõc) ===
        let idx = 0;
        const userAnswers = new Array(QUESTIONS.length).fill(null);
        const card = document.getElementById('card');

        function renderQuestion(i) {
            const item = QUESTIONS[i];
            card.innerHTML = `
        <div class="question">
          <div class="q-index">${i + 1}/${QUESTIONS.length}</div>
          <div class="q-body">
            <p class="q-text">${escapeHtml(item.q)}</p>
            <div class="options">
              ${item.opts.map((o, j) => `<div class="opt" data-idx="${j}"><strong>${String.fromCharCode(65 + j)}.</strong> ${(o)}</div>`).join('')}
            </div>
            <div class="controls">
              <button id="prev" class="ghost">Quay l·∫°i</button>
              <button id="next">Ti·∫øp</button>
              <button id="showResult" class="ghost">Xem k·∫øt qu·∫£</button>
            </div>
            <div class="explain" id="explain"></div>
            <div class="scorebar">
              <div class="meta">ƒêi·ªÉm t·∫°m: <strong id="tempScore">0</strong></div>
              <div class="progress"><i id="bar"></i></div>
              <div class="meta">${i + 1}/${QUESTIONS.length}</div>
            </div>
            <div class="result" id="resultBox"></div>
          </div>
        </div>`;
            card.querySelectorAll('.opt').forEach(el => el.addEventListener('click', () => onChoose(parseInt(el.dataset.idx))));
            document.getElementById('prev').addEventListener('click', () => { if (idx > 0) idx--, renderQuestion(idx); });
            document.getElementById('next').addEventListener('click', () => { if (idx < QUESTIONS.length - 1) { idx++; renderQuestion(idx); } else { grade(); } });
            document.getElementById('showResult').addEventListener('click', grade);
            if (userAnswers[i] !== null) { const sel = card.querySelector(`.opt[data-idx="${userAnswers[i]}"]`); if (sel) sel.classList.add('selected'); revealExplanation(i); } else { updateTempScore(); }
        }

        function onChoose(choice) {
            userAnswers[idx] = choice;
            card.querySelectorAll('.opt').forEach(el => el.classList.remove('selected', 'correct', 'wrong'));
            const el = card.querySelector(`.opt[data-idx="${choice}"]`);
            if (el) el.classList.add('selected');
            revealExplanation(idx);
            updateTempScore();
        }

        function revealExplanation(i) {
            const item = QUESTIONS[i];
            const expl = document.getElementById('explain');
            expl.style.display = 'block';
            const sel = userAnswers[i];
            if (sel === null) { expl.textContent = 'B·∫°n ch∆∞a ch·ªçn ƒë√°p √°n.'; return; }
            const isCorrect = sel === item.a;
            expl.innerHTML = `<strong>ƒê√°p √°n:</strong> ${String.fromCharCode(65 + item.a)}. ${item.opts[item.a]}<br><br><strong>K·∫øt lu·∫≠n:</strong> ${isCorrect ? '<span style="color:var(--success)">ƒê√∫ng</span>' : '<span style="color:var(--danger)">Sai</span>'}<br><div style="margin-top:8px;color:var(--muted)">${item.explain}</div>`;
            card.querySelectorAll('.opt').forEach(el => {
                const j = parseInt(el.dataset.idx);
                el.classList.remove('correct', 'wrong');
                if (j === item.a) el.classList.add('correct');
                else if (j === sel && j !== item.a) el.classList.add('wrong');
            });
        }

        function updateTempScore() {
            const score = userAnswers.reduce((s, ans, i) => s + (ans === QUESTIONS[i].a ? 1 : 0), 0);
            document.getElementById('tempScore').textContent = score + '/' + QUESTIONS.length;
            document.getElementById('bar').style.width = (score / QUESTIONS.length * 100) + '%';
        }

        function grade() {
            const score = userAnswers.reduce((s, ans, i) => s + (ans === QUESTIONS[i].a ? 1 : 0), 0);
            const box = document.getElementById('resultBox');
            box.style.display = 'block';
            box.innerHTML = `<h3>K·∫øt qu·∫£: ${score}/${QUESTIONS.length}</h3>
        <p style="margin:6px 0;color:var(--muted)">${(score / QUESTIONS.length * 100).toFixed(0)}% ‚Äî ${interpretScore(score)}</p>
        <div style="margin-top:8px"><button id="retry" class="ghost">L√†m l·∫°i</button></div>`;
            document.getElementById('retry').addEventListener('click', () => { for (let i = 0; i < userAnswers.length; i++) userAnswers[i] = null; idx = 0; renderQuestion(idx); updateTempScore(); box.style.display = 'none'; });
        }

        function interpretScore(s) {
            const pct = s / QUESTIONS.length;
            if (pct === 1) return 'Tuy·ªát v·ªùi ‚Äî 10 ƒëi·ªÉm';
            if (pct >= 0.8) return 'Gi·ªèi ‚Äî 9 ƒëi·ªÉm';
            if (pct >= 0.6) return 'Kh√° ‚Äî 7 ƒëi·ªÉm';
            if (pct >= 0.4) return 'Trung b√¨nh ‚Äî 5 ƒëi·ªÉm';
            return 'C·∫ßn c·ªë g·∫Øng';
        }

        function escapeHtml(s) {
            return String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        renderQuestion(0);
        updateTempScore();
    </script>
</body>

</html>